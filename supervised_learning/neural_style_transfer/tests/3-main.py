#!/usr/bin/env python3

import matplotlib.image as mpimg
import numpy as np
import tensorflow as tf
import os

NST = __import__('3-neural_style').NST


if __name__ == '__main__':
    style_image = mpimg.imread("starry_night.jpg")
    content_image = mpimg.imread("golden_gate.jpg")

    # Reproducibility
    seed=31415
    np.random.seed(seed)
    tf.random.set_seed(seed)
    os.environ['PYTHONHASHSEED'] = str(seed)
    os.environ['TF_DETERMINISTIC_OPS'] = '1'

    nst = NST(style_image, content_image)
    print(nst.gram_style_features)
    print(nst.content_feature)

# Expected Output:
# [<tf.Tensor: shape=(1, 64, 64), dtype=float32, numpy=
# array([[[ 5756.8267 ,  2460.2236 ,  1735.3108 , ...,  1802.0953 ,
#           1436.8545 ,  2283.8472 ],
#         [ 2460.2236 ,  6018.7217 ,  2516.9497 , ...,  1394.7166 ,
#           1890.9333 ,  1566.7012 ],
#         [ 1735.3108 ,  2516.9497 ,  1825.6233 , ...,   268.12772,
#           1492.1879 ,  1712.2865 ],
#         ...,
#         [ 1802.0953 ,  1394.7166 ,   268.12772, ..., 11043.293  ,
#           1228.2603 ,   722.04755],
#         [ 1436.8545 ,  1890.9333 ,  1492.1879 , ...,  1228.2603 ,
#           2858.2073 ,  2463.2036 ],
#         [ 2283.8472 ,  1566.7012 ,  1712.2865 , ...,   722.04755,
#           2463.2036 ,  2920.749  ]]], dtype=float32)>, <tf.Tensor: shape=(1, 128, 128), dtype=float32, numpy=
# array([[[1.5858041e+03, 2.0782605e+02, 4.5135851e+00, ...,
#          1.2954677e+03, 9.5775208e+02, 3.6327881e+02],
#         [2.0782605e+02, 1.9686490e+04, 6.1289463e+03, ...,
#          2.3898402e+04, 1.7583596e+04, 8.3043945e+03],
#         [4.5135851e+00, 6.1289463e+03, 2.6190689e+04, ...,
#          2.4666756e+04, 5.2427954e+03, 6.9322803e+03],
#         ...,
#         [1.2954677e+03, 2.3898402e+04, 2.4666756e+04, ...,
#          1.0457127e+05, 3.7401582e+04, 2.2033342e+04],
#         [9.5775208e+02, 1.7583596e+04, 5.2427954e+03, ...,
#          3.7401582e+04, 3.8627859e+04, 8.2048770e+03],
#         [3.6327881e+02, 8.3043945e+03, 6.9322803e+03, ...,
#          2.2033342e+04, 8.2048770e+03, 2.5434398e+04]]], dtype=float32)>, <tf.Tensor: shape=(1, 256, 256), dtype=float32, numpy=
# array([[[ 34338.01   ,   9033.457  ,   3288.6929 , ...,   5748.0396 ,
#           39214.965  ,  21956.795  ],
#         [  9033.457  ,  63893.395  ,   2778.8186 , ...,   2218.5312 ,
#           47704.895  ,  30401.16   ],
#         [  3288.6929 ,   2778.8186 ,   4694.831  , ...,    765.73486,
#            8103.681  ,   4131.631  ],
#         ...,
#         [  5748.0396 ,   2218.5312 ,    765.73486, ...,   7458.743  ,
#            8500.073  ,   7351.757  ],
#         [ 39214.965  ,  47704.895  ,   8103.681  , ...,   8500.073  ,
#          197444.28   ,  58971.99   ],
#         [ 21956.795  ,  30401.16   ,   4131.631  , ...,   7351.757  ,
#           58971.99   ,  91814.66   ]]], dtype=float32)>, <tf.Tensor: shape=(1, 512, 512), dtype=float32, numpy=
# array([[[347401.97 ,  34372.51 ,  56844.438, ...,  42188.094,
#          122456.06 , 228087.9  ],
#         [ 34372.51 ,  57594.324,  45008.125, ...,   8311.541,
#           43632.28 ,  62467.906],
#         [ 56844.438,  45008.125, 212626.08 , ...,  20847.582,
#           81709.234, 169389.62 ],
#         ...,
#         [ 42188.094,   8311.541,  20847.582, ...,  72844.96 ,
#           38133.133,  54592.676],
#         [122456.06 ,  43632.28 ,  81709.234, ...,  38133.133,
#          247241.45 , 186638.66 ],
#         [228087.9  ,  62467.906, 169389.62 , ...,  54592.676,
#          186638.66 , 560682.9  ]]], dtype=float32)>, <tf.Tensor: shape=(1, 512, 512), dtype=float32, numpy=
# array([[[5.6860791e+02, 6.5590324e+00, 1.2003322e+02, ...,
#          2.6593695e+01, 1.1145765e+01, 2.0468984e+00],
#         [6.5590324e+00, 2.0610747e+02, 5.7621437e+01, ...,
#          1.2455083e+01, 3.6151764e+01, 3.4100216e-02],
#         [1.2003322e+02, 5.7621437e+01, 1.5153213e+03, ...,
#          1.2805782e+02, 2.3040190e+02, 1.4489329e+01],
#         ...,
#         [2.6593695e+01, 1.2455083e+01, 1.2805782e+02, ...,
#          3.9987106e+02, 6.0266365e+01, 1.1410820e+01],
#         [1.1145765e+01, 3.6151764e+01, 2.3040190e+02, ...,
#          6.0266365e+01, 4.0007962e+02, 1.0857087e+01],
#         [2.0468984e+00, 3.4100216e-02, 1.4489329e+01, ...,
#          1.1410820e+01, 1.0857087e+01, 1.2647890e+01]]], dtype=float32)>]
# tf.Tensor(
# [[[[ 0.         0.        19.733797  ...  0.        11.781457
#      5.2299395]
#    [ 0.         0.         0.        ...  0.        25.19229
#      0.       ]
#    [ 0.         0.         0.        ...  0.        20.169622
#      0.       ]
#    ...
#    [ 0.         0.         0.        ...  0.        29.54027
#      0.       ]
#    [ 0.         0.         0.        ...  0.        26.545824
#      0.       ]
#    [ 0.         0.         0.        ...  0.        12.675021
#      0.       ]]

#   [[ 0.         0.        20.057331  ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    ...
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]]

#   [[ 0.         0.         8.540512  ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    ...
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]]

#   ...

#   [[ 0.         0.        61.629906  ...  0.        32.28077
#     22.304934 ]
#    [ 0.         1.088329  11.590074  ...  0.        28.076933
#      7.837166 ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    ...
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]]

#   [[ 0.         0.        32.140472  ...  0.         5.3724256
#      9.400144 ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    ...
#    [ 0.         0.        10.864371  ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]]

#   [[ 0.         0.        21.650887  ...  0.         0.
#     11.990651 ]
#    [ 0.         0.         3.6726925 ...  0.792972   0.
#      0.       ]
#    [ 0.         0.         0.        ... 10.631976   0.
#      0.       ]
#    ...
#    [ 0.         0.        24.136818  ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  0.         0.
#      0.       ]
#    [ 0.         0.         0.        ...  1.7109064  0.
#      0.       ]]]], shape=(1, 21, 32, 512), dtype=float32)
