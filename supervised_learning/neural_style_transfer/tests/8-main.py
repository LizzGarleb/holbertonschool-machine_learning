#!/usr/bin/env python3

import matplotlib.image as mpimg
import numpy as np
import tensorflow as tf
import os

NST = __import__('8-neural_style').NST


if __name__ == '__main__':
    style_image = mpimg.imread("starry_night.jpg")
    content_image = mpimg.imread("golden_gate.jpg")

    # Reproducibility
    seed=31415
    np.random.seed(seed)
    tf.random.set_seed(seed)
    os.environ['PYTHONHASHSEED'] = str(seed)
    os.environ['TF_DETERMINISTIC_OPS'] = '1'  

    nst = NST(style_image, content_image)
    generated_image = tf.Variable(nst.content_image)
    grads, J_total, J_content, J_style = nst.compute_grads(generated_image)
    print(J_total)
    print(J_content)
    print(J_style)
    print(grads)

# Expected Output:
# tf.Tensor(1382607000.0, shape=(), dtype=float32)
# tf.Tensor(0.0, shape=(), dtype=float32)
# tf.Tensor(1382607000.0, shape=(), dtype=float32)
# tf.Tensor(
# [[[[-30281.71    -31185.508    -5514.8643 ]
#    [-47544.195   -49884.918    -6556.883  ]
#    [-47072.93    -49907.168     -195.82872]
#    ...
#    [-43909.484   -23380.168    -2821.0803 ]
#    [-49770.71    -35227.86     -9398.802  ]
#    [-24558.299   -16142.874      413.7837 ]]

#   [[-42368.867   -40488.79     -4633.434  ]
#    [-57778.492   -56196.41      3928.6292 ]
#    [-61378.67    -62088.875    10039.892  ]
#    ...
#    [-21626.395    21401.857    35472.13   ]
#    [-47766.54    -17765.361    11174.258  ]
#    [-29687.584   -13436.832     8099.749  ]]

#   [[-20770.006   -12154.945    15716.192  ]
#    [-28302.959   -18114.117    32193.248  ]
#    [-34254.99    -29397.414    37171.453  ]
#    ...
#    [ 16380.45     68325.97     73827.4    ]
#    [-21376.863    13775.226    40715.66   ]
#    [-17080.176     1779.7423   23625.842  ]]

#   ...

#   [[  -612.89954 -10816.352    -4357.6807 ]
#    [ -7058.4194  -23714.531   -14322.685  ]
#    [  1293.8757  -14799.57    -11165.33   ]
#    ...
#    [-12058.143    12944.229   -20676.086  ]
#    [-10640.132     7900.848   -18989.945  ]
#    [ -3995.5261    6648.425    -9410.414  ]]

#   [[ -3454.6362  -10147.059    -3566.8477 ]
#    [-12768.988   -24323.62    -12683.674  ]
#    [-11214.301   -23123.023   -12982.376  ]
#    ...
#    [ -3461.5166   14591.121    -9714.928  ]
#    [ -2625.936    10576.891    -8551.56   ]
#    [   146.09515   7531.932    -3822.3887 ]]

#   [[   121.98756  -1971.4235    -179.03679]
#    [ -2496.5752   -6294.538    -2796.091  ]
#    [ -1610.1425   -5576.467    -2604.0437 ]
#    ...
#    [ -3227.183     5372.462    -5656.1143 ]
#    [ -2449.933     3686.4343   -4798.956  ]
#    [  -420.32666   2890.8557   -2043.5912 ]]]], shape=(1, 343, 512, 3), dtype=float32)